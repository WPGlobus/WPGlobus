!function(c){"use strict";var p;"undefined"!=typeof WPGlobusWidgets&&(p={saveArbitraryTextOrHTML:!1,editor:{},languageBoxActive:!1,languageBoxTimeout:null,init:function(){p.addElements(),p.attachListeners(),p.arbitraryTextOrHTML()},wysiwygClean:function(){c(".wpglobus-dialog-field").each(function(e,t){var i,a=c(t).data("source-id");1==c("#"+a+"-tmce").size()&&(i=c(t).next(".wpglobus_dialog_start"),c(t).remove(),c(i).remove())})},setupWidgetControl:function(a,e,i){var t,o,n,d,r,l,u,s,g=!1;c.each(p.editor,function(e,t){if(t.widgetName==a)return!(g=!0)}),g||(""==(o=e.$el[0].id)&&(t=e.$el[0].offsetParent,void 0===(o=c(t).attr("id"))&&c(".widget").each(function(e,t){var i=c(t).attr("id");if(-1!=i.indexOf(a))return o=i,!1})),n="#"+o+" #widget-"+a+"-text",d="#"+o+" #widget-"+a+"-title",p.editor[i.id]={},p.editor[i.id].widgetName=a,p.editor[i.id].controls=e,p.editor[i.id].sourceTitleSelector=d,p.editor[i.id].titleSelector=null,p.editor[i.id].sourceSelector=n,p.editor[i.id].content=c(n).val(),p.editor[i.id].saveSelector="#"+o+" #widget-"+a+"-savewidget",p.editor[i.id].languageSelector="#"+o+" .wpglobus-current-language",p.editor[i.id].inWidgetTitleSelector="#"+o+" .in-widget-title",r=WPGlobusCore.TextFilter(p.editor[i.id].content,WPGlobusCoreData.default_language,"RETURN_EMPTY"),c("#"+i.id).val(r),u=l="",c.each(WPGlobusCoreData.enabled_languages,function(e,t){l=(l=(l=(l=(l=(l=(l='<a href="#" onclick="return false;" class="item" data-widget-id="{{widgetID}}" data-source="{{source}}" data-editor-id="{{editorID}}" data-language="{{language}}" data-widget-name="{{widgetName}}" style="text-align:center;"><span>{{item}}</span></a>').replace("{{language}}",t)).replace("{{item}}",WPGlobusCoreData.en_language_name[t])).replace("{{widgetName}}",a)).replace("{{widgetID}}",o)).replace("{{editorID}}",i.id)).replace("{{source}}",n),u+=l}),s='<button style="z-index:200000;" type="button" id="'+i.id+'-wpglobus-button" data-widget-id="'+o+'"class="wp-switch-editor switch-wpglobus-language wpglobus-icon-globe"><span class="wpglobus-current-language" data-language="en" style="">En</span></button><div class="wpglobus-language-box" style="position:absolute;top:0;left:0;display:none;z-index:200100;border:1px solid #9e9e9e;border-radius:3px;background-color:#fff;padding: 2px 5px;"><div style="display:flex;flex-direction:column;">'+u+"</div></div>",c("#"+o+" .wp-editor-tabs").append(s),WPGlobusDialogApp.addElement({id:e.fields.title[0].id,style:"width:93%;"})&&(p.editor[i.id].titleSelector="#"+e.fields.title[0].id),p.arbitraryWidgetTitle(i.id))},arbitraryWidgetTitle:function(e){var t=WPGlobusCore.TextFilter(c("#"+p.editor[e].controls.fields.title[0].id).val(),WPGlobusCoreData.language);c(p.editor[e].inWidgetTitleSelector).text(": "+t)},setBoxTimeout:function(){p.languageBoxTimeout=setTimeout(function(){p.languageBoxActive=!1,c(".wpglobus-language-box").css({display:"none"})},1e3)},arbitraryTextOrHTML:function(){function i(e){var t,i,a="",a="keyup"==e.type&&"tinymce"==e.target.id?c(e.target).data("id"):e.target.id;p.editor[a]&&(t=c(p.editor[a].languageSelector).data("language"),i="",i=tinymce.get(a).isHidden()?c("#"+a).val():tinymce.get(a).getContent({format:"raw"}),p.editor[a].content=WPGlobusCore.getString(p.editor[a].content,i,t),c(p.editor[a].sourceSelector).val(p.editor[a].content))}c(document).on("click",".switch-wpglobus-language",function(e){var t,i,a;p.languageBoxActive||(p.languageBoxActive=!0,i=(t=c(this)).data("widget-id"),(a=t.position()).top+=34,a.left+=10,c("#"+i+" .wpglobus-language-box").css({display:"block",top:a.top+"px",left:a.left+"px"}),p.setBoxTimeout())}),c(document).on("mouseenter",".wpglobus-language-box",function(e){clearTimeout(p.languageBoxTimeout)}).on("mouseleave",".wpglobus-language-box",function(e){c(".wpglobus-language-box").css({display:"none"}),p.languageBoxActive=!1}),c(document).on("click",".wpglobus-language-box .item",function(e){var t=c(this),i=t.data("language"),a=t.data("widget-id"),o=t.data("editor-id");c("#"+a+" .wpglobus-current-language").text(i).data("language",i);var n=WPGlobusCore.TextFilter(p.editor[o].content,i,"RETURN_EMPTY");tinymce.get(o).setContent(n,{format:"raw"}),c("textarea#"+o).val(n)}),c(document).on("tinymce-editor-setup",function(e,i){c.each(wp.textWidgets.widgetControls,function(e,t){p.setupWidgetControl(e,t,i)})}),c(document).on("tinymce-editor-init",function(e,t){c(document).on("mouseenter",p.editor[t.id].saveSelector,function(e){c(p.editor[t.id].sourceTitleSelector).val(c(p.editor[t.id].titleSelector).val()),c(p.editor[t.id].sourceSelector).val(p.editor[t.id].content)}),c(document).on("click",p.editor[t.id].saveSelector,function(e){p.saveArbitraryTextOrHTML=t.id}),t.on("nodechange keyup",_.debounce(i,100)),c("#"+t.id).on("keyup",_.debounce(i,100))})},addElements:function(e,t){var i,a=[];a[0]='input[type="text"]',a[1]="textarea",void 0===e||"class"==e?(i=".widget-liquid-right .widget .widget-content",c.each(a,function(e,t){p.makeClone(i,t)})):"id"==e&&(i="#"+t+" .widget-content",c.each(a,function(e,t){p.makeClone(i,t)}))},makeClone:function(e,u){c(e+" "+u).each(function(e,t){var i,a,o,n,d=c(t),r=!1,l=d.attr("id");return void 0===l||-1!=l.indexOf("-number")||""==l||(_.each(WPGlobusWidgets.disabledMask,function(e){if(-1!=l.indexOf(e))return!(r=!0)}),!!r||(i=c("#"+l).clone(),c(d).addClass("wpglobus-dialog-field-source hidden"),a=d.attr("name"),c(i).attr("id","wpglobus-"+l),c(i).attr("name","wpglobus-"+a),c(i).attr("data-source-id",l),c(i).attr("class","wpglobus-dialog-field"),c(i).attr("style","width:90%;"),o=WPGlobusCore.TextFilter(c(d).val(),WPGlobusCoreData.language),c(i).val(o),c('<div style="width:20px;" data-type="control" data-source-type="" data-source-id="'+l+'" class="wpglobus-widgets wpglobus_dialog_start wpglobus_dialog_icon"></div>').insertAfter(d),c(i).insertAfter(d),void('input[type="text"]'==u&&""!=o&&(n=d.parents(".widget").attr("id"),c("#"+n+" .in-widget-title").text(": "+o)))))})},attachListeners:function(){c(document).ajaxComplete(function(e,t,i){if(-1!=i.data.indexOf("action=save-widget")&&-1==i.data.indexOf("delete_widget=1")){if(p.saveArbitraryTextOrHTML){var a=WPGlobusCore.TextFilter(p.editor[p.saveArbitraryTextOrHTML].content,c(p.editor[p.saveArbitraryTextOrHTML].languageSelector).data("language"),"RETURN_EMPTY");return tinymce.get(p.saveArbitraryTextOrHTML).isHidden()?(c("#"+p.saveArbitraryTextOrHTML).val(a),c("#"+p.saveArbitraryTextOrHTML+"-tmce").click()):tinymce.get(p.saveArbitraryTextOrHTML).setContent(a,{format:"raw"}),p.arbitraryWidgetTitle(p.saveArbitraryTextOrHTML),void(p.saveArbitraryTextOrHTML=!1)}var o=(o=i.data.split("widget-id="))[1].split("&");c(".widget-liquid-right .widget").each(function(e,t){var i=c(t).attr("id");-1!==i.indexOf(o[0])&&(p.addElements("id",i),p.wysiwygClean())})}}),c("body").on("change",".wpglobus-dialog-field",function(){var i,a,o=c(this),e="#"+o.data("source-id"),n="";i=c(e).val(),/(\{:|\[:|<!--:)[a-z]{2}/.test(i)?(c.each(WPGlobusCoreData.enabled_languages,function(e,t){""!=(a=t==WPGlobusCoreData.language?o.val():WPGlobusCore.TextFilter(i,t,"RETURN_EMPTY"))&&(n+=WPGlobusCore.addLocaleMarks(a,t))}),c(e).val(n)):c(e).val(o.val())}),c(document).on("click",".widget-title, .widget-title-action",function(e){e.preventDefault(),p.wysiwygClean(),p.imageWidget(this)})},imageWidget:function(e){var t,i,a,o,n,d=c(e).parents(".widget").attr("id");-1!=d.indexOf("media_image")&&(t=c("#"+d+" .in-widget-title"),-1!=(i=c("#"+d).find('input[type="text"]').attr("id")).indexOf(".")?(a="wpg-"+i.replace(".","_"),c("#"+d).find('input[type="text"]').attr("name",a),WPGlobusDialogApp.addElement(a)&&(o=c("#"+d).find('input[name="'+a+'"]'),n=WPGlobusCore.getTranslations(o.val())[WPGlobusCoreData.language],t.text(": "+n),setTimeout(function(){c("#wpglobus-"+a).val(n)},1e3))):WPGlobusDialogApp.addElement(i)&&(n=WPGlobusCore.getTranslations(c("#"+i).val())[WPGlobusCoreData.language],t.text(": "+n),setTimeout(function(){c("#wpglobus-"+i).val(n)},1e3)))}},WPGlobusWidgets=c.extend({},WPGlobusWidgets,p))}(jQuery);